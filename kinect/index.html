<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Kinect - Spatial Auditory Feedback</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Kinect";
        var mkdocs_page_input_path = "kinect.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Spatial Auditory Feedback
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Kinect</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#programs">Programs</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#prelude">Prelude</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fun-stuff">Fun Stuff</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../processing/">Processing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ios/">iOS</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Spatial Auditory Feedback</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Kinect</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="kinect">Kinect</h1>
<h2 id="introduction">Introduction</h2>
<p>The Kinect for Xbox 360 (also known as the Kinect v1) was developed by <a href="https://github.com/PrimeSense">PrimeSense</a> in collaboration with <a href="https://github.com/OpenNI">OpenNI</a>. A couple years later, Microsoft began development on the Kinect for Xbox One (also known as the Kinect v2). Additionally, PrimeSense who made the original Kinect was aquired by Apple.</p>
<p>While the Kinect v2 was designed for PC's and the Xbox One, many open-source developers continued the development of the Kinect v2 drivers which still obtain data aquisition via the OpenNI2 drivers. <a href="https://github.com/OpenKinect/libfreenect2">Libfreenect2</a>, a wrapper library, was written for obtaining the RGB and depth data which depends on the OpenNI2 drivers. This library is what the submodule in the <a href="https://github.gatech.edu/L42i/spatial-auditory-feedback/tree/main/Kinect"><code>Kinect</code></a> folder points to, and it contains all of the software one needs to control/view data from the Kinect v2 sensor. It does not contain the software which performs pose tracking.</p>
<p>However, because the data retrieved by the OpenNI2 drivers is similar to that of the OpenNI drivers written for the Kinect v1, it is possible to use the old tracking algorithms created by PrimeSense known as NiTE. A future goal of the Spatial Auditory Feedback project is to use open-source pose tracking algorithms, such as <a href="https://github.com/CMU-Perceptual-Computing-Lab/openpose">OpenPose</a>, <a href="https://github.com/google-ai-edge/mediapipe">MediaPipe</a>, or <a href="https://github.com/joaquimrocha/Skeltrack">Skeltrack</a> which was designed specifically for the Kinect v2.</p>
<p>Further exploration and testing is needed here. For now, the installation guide on the next page will cover installing libfreenect2 and the NiTE2.2 shared library.</p>
<h2 id="installation">Installation</h2>
<p>Step 1: Update the package list</p>
<pre><code class="language-shell">sudo apt update
</code></pre>
<p>Step 2: Install build tools:</p>
<pre><code class="language-shell">sudo apt install build-essential cmake pkg-config
</code></pre>
<p>Step 3: Install libusb (for getting the Kinect to talk to the USB ports)</p>
<pre><code class="language-shell">sudo apt install libusb-1.0-0-dev
</code></pre>
<p>Step 4: Install graphics libraries (for displaying the camera output from the sensor)</p>
<pre><code class="language-shell">sudo apt install libturbojpeg0-dev libglfw3-dev
</code></pre>
<p>Step 5: Install OpenNI2 libraries/tools (they will be needed later for testing and installation of libfreenect2)</p>
<pre><code class="language-shell">sudo apt install libopenni2-dev openni2-utils
</code></pre>
<p>Step 6: Clone libfreenect2 and enter the directory</p>
<pre><code class="language-shell">git clone https://github.com/OpenKinect/libfreenect2.git
cd libfreenect2
</code></pre>
<p>Step 7: Build and install the libfreenect2 library from source</p>
<pre><code class="language-shell">mkdir build &amp;&amp; cd build
cmake .. -DCMAKE_INSTALL_PREFIX=$HOME/freenect2
make
make install
</code></pre>
<p><strong>Note: You need to specify <code>cmake -Dfreenect2_DIR=$HOME/freenect2/lib/cmake/freenect2</code> for CMake based third-party application to find libfreenect2.</strong></p>
<p>Step 8: Install the openni2 library from here</p>
<pre><code class="language-shell">sudo make install-openni2
</code></pre>
<p>Step 9: Set up udev rules for device access.</p>
<pre><code class="language-shell">sudo cp ../platform/linux/udev/90-kinect2.rules /etc/udev/rules.d/
</code></pre>
<p><strong>Note: If any Kinects were plugged into the USB ports, each one needs to be re-plugged again for the USB to recognize it with the updated rules.</strong></p>
<p>Step 10: Create symbolic links to installed libraries which are missing and required for everything to work.</p>
<pre><code class="language-shell">sudo ln -s /usr/lib/x86_64-linux-gnu/OpenNI2/Drivers/libfreenect2-openni2.so /usr/lib/x86_64-linux-gnu/OpenNI2/Drivers/libFreenectDriver.so
sudo ln -s /usr/lib/x86_64-linux-gnu/OpenNI2/Drivers/libfreenect2-openni2.so.0 /usr/lib/x86_64-linux-gnu/OpenNI2/Drivers/libFreenectDriver.so.0
</code></pre>
<p><strong>Note: Remember these paths, and make sure they exist. They will be needed when we run the NiTE tracker in the next steps below. See: <a href="https://github.com/OpenKinect/libfreenect2/issues/639">https://github.com/OpenKinect/libfreenect2/issues/639</a> for more context.</strong></p>
<h2 id="programs">Programs</h2>
<h3 id="prelude">Prelude</h3>
<p>There are a couple items to complete before having fun with the Kinect sensors. Some of these you may need to do every time you boot the system. Others may be a one-time checklist item.</p>
<ul>
<li>Run <code>lsusb</code> and make sure each Kinect is attached to a bus which is on a USB 3.0 root controller. USB 3.0 is required for the Kinect Xbox One (Kinect v2)</li>
<li>Download and unzip the NiTE tracking library by PrimeSense archived here: <a href="https://bitbucket.org/kaorun55/openni-2.2/src/2f54272802bfd24ca32f03327fbabaf85ac4a5c4/NITE%202.2%20%CE%B1/?at=master">https://bitbucket.org/kaorun55/openni-2.2/src/2f54272802bfd24ca32f03327fbabaf85ac4a5c4/NITE%202.2%20%CE%B1/?at=master</a>. Rich 133B has a 64-bit Linux system, so it should be the x64-Linux one.</li>
<li>Remember the last note about those paths? This is where they are needed. Open the file located in the downloaded NiTE package as described below:</li>
</ul>
<pre><code class="language-shell">cd ~/Downloads/NiTE-Linux-x64-2.2/Samples/Bin
sudo nano OpenNI.ini
</code></pre>
<ul>
<li>
<p>Uncomment the line ';Repository=OpenNI2/Drivers' by removing the ';' and set repository to the path. It should look something like this:
<code>Repository=/usr/lib/x86_64-linux-gnu/OpenNI2/Drivers</code>. Save the file and exit.</p>
</li>
<li>
<p>Set the UBFS buffer size to 32MB (this one is required on every boot). Otherwise libusb will not have enough memory, as the default on system boot is 16MB. Each Kinect v2 sensor uses 16MB which adds up to 32MB total. Read this guide for more info on how to calculate the memory: <a href="https://www.flir.com/support-center/iis/machine-vision/application-note/understanding-usbfs-on-linux/?srsltid=AfmBOood-y0AC2UhSXvvTEc693SOaK5ANXoG_BEoVPKJCJtMeKu25VND">Understanding USBFS on Linux</a>.</p>
</li>
</ul>
<pre><code class="language-shell">sudo sh -c 'echo 32 &gt; /sys/module/usbcore/parameters/usbfs_memory_mb'
</code></pre>
<h3 id="fun-stuff">Fun Stuff</h3>
<p>Now any of the OpenNI2, libfreenect2, and NiTE programs should be able to run with the Kinects! The OpenNI2 programs should be in your path.</p>
<ul>
<li>The OpenNI2 programs are listed in <a href="https://github.com/OpenNI/OpenNI2/tree/master/Samples">https://github.com/OpenNI/OpenNI2/tree/master/Samples</a></li>
<li>The libfreenect2 program is in <code>/path/to/libfreenect2/build/bin/</code>. It can be run via <code>./path/to/libfreenect2/build/bin/Protonect</code>.</li>
<li>The NiTE programs are in <code>/path/to/NiTE-Linux-x64-2.2/Samples/Bin</code>. The one which shows the tracked skeleton is called <code>UserViewer</code> and can be run via <code>./path/to/NiTE-Linux-x64-2.2/Samples/Bin/UserViewer</code>. Note this program was intended for the original Kinect v1 sensor, so it doesn't perform optimally with the Kinect v2 sensors due to the down-scaled resolution. Further investigation on an alternative skeleton tracking method is in progress.</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href=".." class="btn btn-neutral float-left" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../processing/" class="btn btn-neutral float-right" title="Processing">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../processing/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
